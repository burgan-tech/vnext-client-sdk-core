{
    "multiStageMode": "onStartup",
    "defaultStage": "localhost",
    "selector-workflow": {
        "runtime": "v2",
        "baseUrl": "http://localhost:3001/api/v1/",
        "domain": "discovery",
        "workflow": "enviroment-selector",
        "requiredToken": [
            { "provider": "morph-idm-1fa", "token": "access" },
            { "provider": "morph-idm-device", "token": "access" }
        ]
    },
    "stages": [
        {
            "key": "localhost",
            "title": "Local Development",
            "baseUrl": "http://localhost:3001/api/v1/",
            "wsUrl": "ws://localhost:3001",
            "mqttUrl": "mqtt://localhost:1883",
            "configEndpoint": {
                "runtime": "v2",
                "level": "instance",
                "domain": "discovery",
                "workflow": "enviroment",
                "key": "localhost",
                "function": "enviroment",
                "requiredToken": [
                    { "provider": "morph-idm-1fa", "token": "access" },
                    { "provider": "morph-idm-device", "token": "access" }
                ]
            },
            "authProviders": [
                {
                    "key": "morph-idm-device",
                    "type": "oauth2",
                    "tokenTypes": {
                        "access": {
                            "expiry": "infinite",
                            "storage": {
                                "context": "device",
                                "key": "auth.token.morph-idm-device.access"
                            }
                        }
                    }
                },
                {
                    "key": "morph-idm-1fa",
                    "type": "oauth2",
                    "logout": {
                        "endpoint": "/auth/logout/1fa"
                    },
                    "tokenTypes": {
                        "access": {
                            "expiry": "1d",
                            "storage": {
                                "context": "user",
                                "key": "auth.token.morph-idm-1fa.access"
                            }
                        }
                    }
                },
                {
                    "key": "morph-idm-2fa",
                    "type": "oauth2",
                    "grantFlow": {
                        "runtime": "v2",
                        "domain": "morph-idm",
                        "workflow": "mobile-login",
                        "requiredToken": [
                            { "provider": "morph-idm-1fa", "token": "access" },
                            { "provider": "morph-idm-device", "token": "access" }
                        ]
                    },
                    "logout": {
                        "endpoint": "/auth/logout",
                        "autoLogoutAtBackground": "1m",
                        "autoLogoutAtInactivity": "5m"
                    },
                    "tokenTypes": {
                        "access": {
                            "expiry": "1m",
                            "storage": {
                                "context": "secureMemory",
                                "key": "auth.token.morph-idm-2fa.access"
                            }
                        },
                        "refresh": {
                            "expiry": "1d",
                            "endpoint": "/auth/token/refresh",
                            "strategy": "rotating",
                            "beforeExpiry": "15s",
                            "storage": {
                                "context": "user",
                                "key": "auth.token.morph-idm-2fa.refresh"
                            }
                        }
                    }
                },
                {
                    "key": "edevlet",
                    "type": "oauth2",
                    "authorizationUrl": "https://giristest.turkiye.gov.tr/OAuth2/authorize",
                    "tokenUrl": "https://giristest.turkiye.gov.tr/OAuth2/token",
                    "clientId": "{{clientId}}",
                    "scopes": [
                        "profile",
                        "tcno"
                    ],
                    "pkce": true,
                    "tokenExchange": {
                        "endpoint": "/auth/exchange/edevlet"
                    },
                    "logout": {
                        "endpoint": "/auth/logout/edevlet"
                    },
                    "tokenTypes": {
                        "access": {
                            "expiry": "1h",
                            "storage": {
                                "context": "secureMemory",
                                "key": "auth.token.edevlet.access"
                            }
                        },
                        "refresh": {
                            "expiry": "7d",
                            "endpoint": "/auth/token/refresh",
                            "strategy": "rotating",
                            "beforeExpiry": "5m",
                            "storage": {
                                "context": "user",
                                "key": "auth.token.edevlet.refresh"
                            }
                        }
                    }
                },
                {
                    "key": "burgan-yatirim",
                    "type": "oauth2",
                    "scheme": "burganyatirim://auth",
                    "fallbackUrl": "https://play.google.com/store/apps/details?id=com.burgan.yatirim",
                    "callbackScheme": "vnextapp://auth/callback/burgan-yatirim",
                    "tokenExchange": {
                        "endpoint": "/auth/exchange/burgan-yatirim"
                    },
                    "tokenTypes": {
                        "access": {
                            "expiry": "30m",
                            "storage": {
                                "context": "secureMemory",
                                "key": "auth.token.burgan-yatirim.access"
                            }
                        }
                    }
                },
                {
                    "key": "fxtrade",
                    "type": "oauth2",
                    "url": "https://fxtrade-test.burgan.com.tr/login",
                    "callbackPattern": "vnextapp://auth/callback/fxtrade",
                    "tokenExchange": {
                        "endpoint": "/auth/exchange/fxtrade"
                    },
                    "tokenTypes": {
                        "access": {
                            "expiry": "1h",
                            "storage": {
                                "context": "secureMemory",
                                "key": "auth.token.fxtrade.access"
                            }
                        }
                    }
                }
            ]
        },
        {
            "key": "pilot",
            "title": "Pilot",
            "baseUrl": "https://pilot-api.example.com",
            "wsUrl": "wss://pilot-ws.example.com/v1",
            "mqttUrl": "mqtts://pilot-mqtt.example.com:8883",
            "configEndpoint": {
                "runtime": "v2",
                "level": "instance",
                "domain": "discovery",
                "workflow": "enviroment",
                "key": "pilot",
                "function": "enviroment",
                "requiredToken": [
                    { "provider": "morph-idm-1fa", "token": "access" },
                    { "provider": "morph-idm-device", "token": "access" }
                ]
            },
            "authProviders": [
                {
                    "key": "morph-idm-device",
                    "type": "oauth2",
                    "tokenTypes": {
                        "access": {
                            "expiry": "infinite",
                            "storage": {
                                "context": "device",
                                "key": "auth.token.morph-idm-device.access"
                            }
                        }
                    }
                },
                {
                    "key": "morph-idm-1fa",
                    "type": "oauth2",
                    "logout": {
                        "endpoint": "/auth/logout/1fa"
                    },
                    "tokenTypes": {
                        "access": {
                            "expiry": "30d",
                            "storage": {
                                "context": "user",
                                "key": "auth.token.morph-idm-1fa.access"
                            }
                        }
                    }
                },
                {
                    "key": "morph-idm-2fa",
                    "type": "oauth2",
                    "grantFlow": {
                        "runtime": "v2",
                        "domain": "morph-idm",
                        "workflow": "mobile-login",
                        "requiredToken": [
                            { "provider": "morph-idm-1fa", "token": "access" },
                            { "provider": "morph-idm-device", "token": "access" }
                        ]
                    },
                    "logout": {
                        "endpoint": "/auth/logout",
                        "autoLogoutAtBackground": "3m",
                        "autoLogoutAtInactivity": "10m"
                    },
                    "tokenTypes": {
                        "access": {
                            "expiry": "3m",
                            "storage": {
                                "context": "secureMemory",
                                "key": "auth.token.morph-idm-2fa.access"
                            }
                        },
                        "refresh": {
                            "expiry": "7d",
                            "endpoint": "/auth/token/refresh",
                            "strategy": "rotating",
                            "beforeExpiry": "30s",
                            "storage": {
                                "context": "user",
                                "key": "auth.token.morph-idm-2fa.refresh"
                            }
                        }
                    }
                },
                {
                    "key": "edevlet",
                    "type": "oauth2",
                    "authorizationUrl": "https://giris.turkiye.gov.tr/OAuth2/authorize",
                    "tokenUrl": "https://giris.turkiye.gov.tr/OAuth2/token",
                    "clientId": "{{clientId}}",
                    "scopes": [
                        "profile",
                        "tcno"
                    ],
                    "pkce": true,
                    "tokenExchange": {
                        "endpoint": "/auth/exchange/edevlet"
                    },
                    "logout": {
                        "endpoint": "/auth/logout/edevlet"
                    },
                    "tokenTypes": {
                        "access": {
                            "expiry": "1h",
                            "storage": {
                                "context": "secureMemory",
                                "key": "auth.token.edevlet.access"
                            }
                        },
                        "refresh": {
                            "expiry": "7d",
                            "endpoint": "/auth/token/refresh",
                            "strategy": "rotating",
                            "beforeExpiry": "5m",
                            "storage": {
                                "context": "user",
                                "key": "auth.token.edevlet.refresh"
                            }
                        }
                    }
                }
            ]
        }
    ]
}
